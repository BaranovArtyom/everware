{% extends "page.html" %}

{% block main %}

<div id="login-main">
<header class="jumbotron masthead">
    <h1>everware</h1>
    <p>Run your notebooks in the cloud</p>
</header>

<form class="form-horizontal" action="/hub/home" method="post" role="form" id="repo_url_entry">
  <div>
    <div class="form-group">
        <input
          type="text"
          class="form-control"
          name="repourl"
          id="repo_input"
          tabindex="1"
          placeholder="URL of git repository"
        />
    </div>
    <input
      type="submit"
      id="login_submit"
      class='btn btn-lg btn-primary btn-block'
      value='Launch'
      tabindex="4"
    />
  </div>
</form>

<footer class="footer">
  <div class="footer-inside">
    <div class="col-sm-10">
        Powered by <a href="https://jupyter.org/">Jupyter</a> and <a href="https://www.docker.com/">Docker</a>
    </div>
    <p style="float: right;">Logged in as {{user.name}}</p>
  </div>
</footer>

{% endblock %}

{% block script %}
<script type="text/javascript">
require(["home"]);

function replaceRepoURL(e) {
    var target = e.target || e.srcElement
    var repo_url = target.repo_input.value;
  
    if (repo_input.startsWith('git@')) {
      repo_url = repo_input.replace(':', '/').replace('git@', 'https://');
      target.repo_input.value = repo_url;
      var msg = document.createElement("div");
      msg.innerText = "We changed the repository's URL for you.";
      var form = target.parentNode;
      form.insertBefore(msg, target);
      e.preventDefault();
    }
}

var form = document.getElementById('repo_url_entry');
if (form.attachEvent) {
  form.attachEvent("submit", replaceRepoURL);
} else {
  form.addEventListener("submit", replaceRepoURL);
}

</script>
{% endblock %}
