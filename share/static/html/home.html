{% extends "page.html" %}

{% block main %}

<div id="login-main">
<header class="jumbotron masthead">
    <h1>everware</h1>
    <p>Sharing is caring</p>
</header>

<form class="form-horizontal" action="/hub/home" method="post" role="form" id="repo_url_entry">
  <div id="form_div">
    <div class="form-group" id="repourl_div">
        <input
          type="text"
          class="form-control"
          name="repourl"
          id="repo_input"
          tabindex="1"
          placeholder="URL of git repository"
        />
    </div>
    <input
      type="submit"
      id="login_submit"
      class='btn btn-lg btn-primary btn-block'
      value='Launch'
      tabindex="4"
    />
  </div>
</form>

<div class="container">
  <div class="row row-centered">
    <div class="col-sm-6" style="float:none; margin:0 auto">
      Paste the link to the git repository you want to try out. If you
      need some inspiration try one of the following repositories:
      <ul>
	<li>https://github.com/everware/everware-dimuon-example</li>
	<li>https://github.com/betatim/everware-demo</li>
      </ul>
      Read the documentation
      to <a href="https://github.com/everware/everware/wiki/Being-everware-compatible">learn
      how to make your repositories work</a> with everware.
    </div>
  </div>
</div>

<footer class="footer">
  <div class="footer-inside">
    <div class="col-sm-8">
        Powered by <a href="https://jupyter.org/">Jupyter</a> and <a href="https://www.docker.com/">Docker</a>
    </div>
    <div style="float: right;">Logged in as {{user.name}} (<a id="logout" href="{{logout_url}}">Logout</a>)</div>
  </div>
</footer>

{% endblock %}

{% block script %}
<script type="text/javascript">
require(["home"]);

function replaceRepoURL(e) {
    var target = e.target || e.srcElement
    var repo_url = target.repo_input.value;

    if (repo_url.startsWith('git@')) {
      e.preventDefault();

      repo_url = repo_url.replace(':', '/').replace('git@', 'https://');
      target.repo_input.value = repo_url;

      var msg = document.createElement("div");
      msg.innerText = "We changed the repository's URL for you.";
      var form_div = document.getElementById('form_div');
      console.log(form_div);
      form_div.insertBefore(msg, document.getElementById("repourl_div"));
    }
}

var form = document.getElementById('repo_url_entry');
if (form.attachEvent) {
  form.attachEvent("submit", replaceRepoURL);
} else {
  form.addEventListener("submit", replaceRepoURL);
}

</script>
{% endblock %}
