language: python

# Needed so we can spawn docker containers
sudo: required
services:
    - docker
addons:
  apt:
    packages:
    - build-essential
python:
    - 3.5
# commented out for testing speed-up sake
#     - 3.4
# env:
#     - JHUB_VERSION=master
#     - JHUB_VERSION=latest # latest released version

before_install:
  - git clone --quiet --depth 1 https://github.com/minrk/travis-wheels travis-wheels
  # some DEBUG information
  - which python
  - pip --version
  - pip freeze
  - npm list

install: 
  - npm install -g gistup
  - export PIP_OPTIONS="-f ~/travis-wheels/wheelhouse"
  - make install
# - ./build_tools/travis/install.sh

script:
  - nose2 -v --start-dir everware # unit tests live in everware/
#  - ./build_tools/travis/test_frontend.sh
  - make run-test-server
  - make test-client || FAIL=1
  - make stop
# will continue on it a bit later
#  - make upload_screens 
  - cat everware.log
  - test "$FAIL" == "1" && exit $FAIL
cache:
  apt: true
  directories:
    - $HOME/.cache/pip
notifications:
  email: false
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/778f542a122b7dd8c0f3
    on_success: always  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: always   
